# The Swedish OpenID Connect Profile

### Version: 1.0 - draft 01 - 2021-04-08

## Abstract

This specification defines a profile for OpenID Connect for use within the Swedish public and private sector. It profiles the OpenID Connect protocol to get a baseline security and to facilitate interoperability between relying parties and OpenID providers.

## Table of Contents

1. [**Introduction**](#introduction)

    1.1. [Requirements Notation and Conventions](#requirements-notation-and-conventions)
    
    1.2. [Conformance](#conformance)
    
2. [**Relying Party Requirements**](#relying-party-requirements)

    2.1. [Authentication Requests](#authentication-requests)

    2.1.1. [Scope Parameter](#scope-parameter)
        
    2.1.2. [State Parameter](#state-parameter)

3. [**OpenID Provider Requirements**](#openid-provider-requirements)

    3.1. [Processing of Authentication Requests](#processing-of-authentication-requests)

X. [**Normative References**](#normative-references)

---

<a name="introduction"></a>
## 1. Introduction

This specification defines a profile for OpenID Connect for use within the Swedish public and private sector. It profiles the OpenID Connect protocol to get a baseline security and to facilitate interoperability between relying parties and OpenID providers.

The profile is loosely based on the International Government Assurance Profile for OpenID Connect draft, \[[OpenID.iGov](#openid-igov)\], but since work and progress within the OpenID foundation iGov working group seems to have stopped, the Swedish OpenID Connect working group has decided to produce a stand-alone profile for OpenID Connect.

> Should the work within the OpenID foundation iGov working group be resumed, the Swedish profile will adapt to this work. 


<a name="requirements-notation-and-conventions"></a>
### 1.1. Requirements Notation and Conventions

The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “MAY”, and “OPTIONAL” are to be interpreted as described in \[[RFC2119](#rfc2119)\].

These keywords are capitalized when used to unambiguously specify requirements over protocol features and behavior that affect the interoperability and security of implementations. When these words are not capitalized, they are meant in their natural-language sense.

<a name="conformance"></a>
### 1.2. Conformance

This profile defines requirements for OpenID Connect Relying Parties (clients) and OpenID Connect Providers (identity providers). Furthermore, it defines the interaction between a Relying Party and an OpenID Provider.

When a component compliant with this profile is interacting with other components compliant with this profile, all components MUST fully conform to the features and requirements of this specification. Any interaction with components that are not compliant with this profile is out of scope for this specification.

<a name="relying-party-requirements"></a>
## 2. Relying Party Requirements

This chapter defines requirements that OpenID Connect Relying Parties MUST adhere to in order to be compliant with this profile.

<a name="authentication-requests"></a>
### 2.1. Authentication Requests

An OpenID Connect authentication request is a request sent to the Authorization endpoint of an OpenID Provider. 

Section 3.1.2.1 of \[[OpenID.Core](#openid-core)\] defines a set of request parameters for OpenID Connect.  

Below follows a table with request parameters that are mandatory according to this profile along with selected optional parameters that has additional requirements or descriptions. 


| Parameter | Description | Mandatory/Optional |
| :--- | :--- | :--- |
| `client_id` | The client identifier valid at the OpenID Provider/Authorization Server. | Mandatory |
| `response_type` | The response type. MUST be set to `code`. | Mandatory |
| `scope` | Indicates the scopes requested. See [2.2.1](#scope-parameter) below. | Mandatory |
| `state` | Random string generated by the Relying Party. The state is used to protect against CSRF attacks. This value is returned to the Relying Party in the authentication response. See [2.2.2](#state-parameter) below. | Mandatory |
| `redirect_uri` | The endpoint where the Relying Party will receive the authentication response. This value MUST be the complete URI. | Mandatory |
| `nonce` | String value used to associate a client session with an ID Token, and to mitigate replay attacks. The value is a (unguessable) random string generated by the Relying Party. The nonce value is returned to the Relying Party in the ID Token. | Mandatory |
| `prompt` | Space delimited, case sensitive list of string values that specifies whether the OpenID Provider prompts the end-user for re-authentication and consent. See [2.1.3](#prompt-parameter) below.| Optional |
| `max_age` | TODO | Optional |
| `id_token_hint` | TODO | Optional |
| `acr_values` | Requested Authentication Context Class Reference values. | Optional |
| `vtr` | Requested Vectors-of-trust.<br />TODO: Write more. | Optional |


> To disuss: Should we write anything about PKCE extension (Proof Key for Code Exchange) and the `code_challenge` and `code_challenge_method` parameters?

<a name="scope-parameter"></a>
#### 2.1.1. Scope Parameter

The `scope` parameter value MUST contain `openid` and MAY contain additional scopes controlling required claims.

> TODO: refer to the attribute specification. 

> To discuss: If a component is compliant with this specification which scopes from the attribute spec must it support?

<a name="state-parameter"></a>
#### 2.1.2. State Parameter

Relying Parties MUST use an unguessable random value for the `state` parameter, where the value has at least 128 bits of entropy. 

Relying Parties MUST validate the value of the `state` parameter upon return to the redirect URI and MUST ensure that the value is tied to the current session of the user.

<a name="prompt-parameter"></a>
#### 2.1.3. Prompt Parameter

A Relying Party may use the `prompt` parameter to control, or prevent, Single Sign On.

By setting the `prompt` parameter to `none` it instructs the OpenID Provider that no display of any authentication or consent views is allowed, and that an error should be returned if the user is not already authenticated at the OpenID Provider. This corresponds to the SAML authentication request attribute `IsPassive=true`.

By setting the `prompt` parameter to `login` the Relying Party instructs the OpenID Provider that the user MUST authenticate, and that it MUST NOT use a previous authentication session for the end-user. This corresponds to the SAML authentication request attribute `ForceAuthn=true`. 

<a name="openid-provider-requirements"></a>
## 3. OpenID Provider Requirements

This chapter defines requirements that OpenID Connect Providers MUST adhere to in order to be compliant with this profile.

<a name="processing-of-authentication-requests"></a>
### 3.1. Processing of Authentication Requests

> TODO

### 3.1.X. redirect_uri

An OpenID Relying Party MUST include the complete redirect URI as a `redirect_uri` parameter value. In order to prevent open redirection and other injection attacks, the OpenID Provider MUST match the entire URI using a direct string comparison against registered values and MUST reject requests with an invalid or missing redirect URI.

### 3.1.X. prompt

TODO: Must be supported.

<a name="normative-references"></a>
## X. Normative References

<a name="rfc2119"></a>
**\[RFC2119\]**
> [Bradner, S., Key words for use in RFCs to Indicate Requirement Levels, March 1997](https://www.ietf.org/rfc/rfc2119.txt).

<a name="oauth2-rfc6749"></a>
**\[OAuth2.RFC6749\]**
> [Hardt, D., "The OAuth 2.0 Authorization Framework", RFC 6749, DOI 10.17487/RFC6749, October 2012](https://tools.ietf.org/html/rfc6749).

<a name="openid-core"></a>
**\[OpenID.Core\]**
> [Sakimura, N., Bradley, J., Jones, M., de Medeiros, B. and C. Mortimore, "OpenID Connect Core 1.0", August 2015](https://openid.net/specs/openid-connect-core-1_0.html).

<a name="openid-discovery"></a>
**\[OpenID.Discovery\]**
> [Sakimura, N., Bradley, J., Jones, M. and E. Jay, "OpenID Connect Discovery 1.0", August 2015](https://openid.net/specs/openid-connect-discovery-1_0.html).

<a name="openid-igov"></a>
**\[OpenID.iGov\]**
> [M. Varley, P. Grassi, "International Government Assurance Profile (iGov) for OpenID Connect 1.0", October 05, 2018](https://openid.net/specs/openid-igov-openid-connect-1_0.html).

<a name="rfc7515"></a>
**\[RFC7515\]**
> [Jones, M., Bradley, J., and N. Sakimura, “JSON Web Token (JWT)”, May 2015](https://tools.ietf.org/html/rfc7515).
